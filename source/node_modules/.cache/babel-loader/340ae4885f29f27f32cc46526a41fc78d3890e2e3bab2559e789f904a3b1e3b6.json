{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { appActions } from '@store/actions';\nimport { createFailureActionType, createSuccessActionType } from '@store/utils';\nimport useActionLoading from './useActionLoading';\nconst {\n  showAppLoading,\n  hideAppLoading,\n  toggleActionLoading\n} = appActions;\nconst handleByType = (typeConfig, handler) => {\n  if (!typeConfig) {\n    return;\n  }\n  if (Array.isArray(typeConfig)) {\n    for (let type of typeConfig) {\n      handler?.[type]?.();\n    }\n  } else {\n    handler?.[typeConfig]?.();\n  }\n};\nconst coverFunction = (func, data, ...restParams) => {\n  if (typeof func !== 'function') {\n    return data;\n  }\n  return func(data, ...restParams);\n};\nconst LOADING_TYPE = {\n  REDUX: 'REDUX',\n  APP: 'APP'\n};\nconst useFetchAction = (action, {\n  immediate = false,\n  prepareSuccessData,\n  payload,\n  loading = LOADING_TYPE.REDUX\n} = {}) => {\n  _s();\n  const dispatch = useDispatch();\n  const isLoading = useActionLoading(action.type);\n  const execute = async (payload = {}) => {\n    handleByType(loading, {\n      [LOADING_TYPE.REDUX]: () => dispatch(toggleActionLoading({\n        type: action.type,\n        isLoading: true\n      })),\n      [LOADING_TYPE.APP]: () => dispatch(showAppLoading())\n    });\n    try {\n      const response = await new Promise((resolve, reject) => {\n        dispatch(action({\n          ...payload,\n          onCompleted: response => resolve(response?.data || {}),\n          onError: reject\n        }));\n      });\n      dispatch({\n        type: createSuccessActionType(action.type),\n        payload: coverFunction(prepareSuccessData, response, payload)\n      });\n    } catch (error) {\n      console.log({\n        error\n      });\n      dispatch({\n        type: createFailureActionType(action.type),\n        payload: error\n      });\n    } finally {\n      handleByType(loading, {\n        [LOADING_TYPE.REDUX]: () => dispatch(toggleActionLoading({\n          type: action.type,\n          isLoading: false\n        })),\n        [LOADING_TYPE.APP]: () => dispatch(hideAppLoading())\n      });\n    }\n  };\n  useEffect(() => {\n    if (immediate) {\n      execute(payload);\n    }\n  }, []);\n  return {\n    execute,\n    loading: isLoading\n  };\n};\n_s(useFetchAction, \"4+Qd3mN4OqSuroOsdC0zAlwmKv0=\", false, function () {\n  return [useDispatch, useActionLoading];\n});\nuseFetchAction.LOADING_TYPE = LOADING_TYPE;\nexport default useFetchAction;","map":{"version":3,"names":["useEffect","useDispatch","appActions","createFailureActionType","createSuccessActionType","useActionLoading","showAppLoading","hideAppLoading","toggleActionLoading","handleByType","typeConfig","handler","Array","isArray","type","coverFunction","func","data","restParams","LOADING_TYPE","REDUX","APP","useFetchAction","action","immediate","prepareSuccessData","payload","loading","_s","dispatch","isLoading","execute","response","Promise","resolve","reject","onCompleted","onError","error","console","log"],"sources":["C:/Users/PC/Downloads/elms-cms/elms-cms/source/src/hooks/useFetchAction.js"],"sourcesContent":["import { useEffect } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\n\r\nimport { appActions } from '@store/actions';\r\nimport { createFailureActionType, createSuccessActionType } from '@store/utils';\r\nimport useActionLoading from './useActionLoading';\r\n\r\nconst { showAppLoading, hideAppLoading, toggleActionLoading } = appActions;\r\n\r\nconst handleByType = (typeConfig, handler) => {\r\n    if (!typeConfig) {\r\n        return;\r\n    }\r\n\r\n    if (Array.isArray(typeConfig)) {\r\n        for (let type of typeConfig) {\r\n            handler?.[type]?.();\r\n        }\r\n    } else {\r\n        handler?.[typeConfig]?.();\r\n    }\r\n};\r\n\r\nconst coverFunction = (func, data, ...restParams) => {\r\n    if (typeof func !== 'function') {\r\n        return data;\r\n    }\r\n\r\n    return func(data, ...restParams);\r\n};\r\n\r\nconst LOADING_TYPE = {\r\n    REDUX: 'REDUX',\r\n    APP: 'APP',\r\n};\r\n\r\nconst useFetchAction = (action, {\r\n    immediate = false,\r\n    prepareSuccessData,\r\n    payload,\r\n    loading = LOADING_TYPE.REDUX,\r\n} = {}) => {\r\n    const dispatch = useDispatch();\r\n    const isLoading = useActionLoading(action.type);\r\n\r\n    const execute = async (payload = {}) => {\r\n        handleByType(loading, {\r\n            [LOADING_TYPE.REDUX]: () => dispatch(toggleActionLoading({ type: action.type, isLoading: true })),\r\n            [LOADING_TYPE.APP]: () => dispatch(showAppLoading()),\r\n        });\r\n\r\n        try {\r\n            const response = await new Promise((resolve, reject) => {\r\n                dispatch(\r\n                    action({\r\n                        ...payload,\r\n                        onCompleted: (response) => resolve(response?.data || {}),\r\n                        onError: reject,\r\n                    }),\r\n                );\r\n            });\r\n\r\n            dispatch({ type: createSuccessActionType(action.type), payload: coverFunction(prepareSuccessData, response, payload) });\r\n        } catch (error) {\r\n            console.log({ error });\r\n            dispatch({ type: createFailureActionType(action.type), payload: error });\r\n        } finally {\r\n            handleByType(loading, {\r\n                [LOADING_TYPE.REDUX]: () => dispatch(toggleActionLoading({ type: action.type, isLoading: false })),\r\n                [LOADING_TYPE.APP]: () => dispatch(hideAppLoading()),\r\n            });\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (immediate) {\r\n            execute(payload);\r\n        }\r\n    }, []);\r\n\r\n    return { execute, loading: isLoading };\r\n};\r\n\r\nuseFetchAction.LOADING_TYPE = LOADING_TYPE;\r\n\r\nexport default useFetchAction;\r\n"],"mappings":";AAAA,SAASA,SAAS,QAAQ,OAAO;AACjC,SAASC,WAAW,QAAQ,aAAa;AAEzC,SAASC,UAAU,QAAQ,gBAAgB;AAC3C,SAASC,uBAAuB,EAAEC,uBAAuB,QAAQ,cAAc;AAC/E,OAAOC,gBAAgB,MAAM,oBAAoB;AAEjD,MAAM;EAAEC,cAAc;EAAEC,cAAc;EAAEC;AAAoB,CAAC,GAAGN,UAAU;AAE1E,MAAMO,YAAY,GAAGA,CAACC,UAAU,EAAEC,OAAO,KAAK;EAC1C,IAAI,CAACD,UAAU,EAAE;IACb;EACJ;EAEA,IAAIE,KAAK,CAACC,OAAO,CAACH,UAAU,CAAC,EAAE;IAC3B,KAAK,IAAII,IAAI,IAAIJ,UAAU,EAAE;MACzBC,OAAO,GAAGG,IAAI,CAAC,GAAG,CAAC;IACvB;EACJ,CAAC,MAAM;IACHH,OAAO,GAAGD,UAAU,CAAC,GAAG,CAAC;EAC7B;AACJ,CAAC;AAED,MAAMK,aAAa,GAAGA,CAACC,IAAI,EAAEC,IAAI,EAAE,GAAGC,UAAU,KAAK;EACjD,IAAI,OAAOF,IAAI,KAAK,UAAU,EAAE;IAC5B,OAAOC,IAAI;EACf;EAEA,OAAOD,IAAI,CAACC,IAAI,EAAE,GAAGC,UAAU,CAAC;AACpC,CAAC;AAED,MAAMC,YAAY,GAAG;EACjBC,KAAK,EAAE,OAAO;EACdC,GAAG,EAAE;AACT,CAAC;AAED,MAAMC,cAAc,GAAGA,CAACC,MAAM,EAAE;EAC5BC,SAAS,GAAG,KAAK;EACjBC,kBAAkB;EAClBC,OAAO;EACPC,OAAO,GAAGR,YAAY,CAACC;AAC3B,CAAC,GAAG,CAAC,CAAC,KAAK;EAAAQ,EAAA;EACP,MAAMC,QAAQ,GAAG5B,WAAW,CAAC,CAAC;EAC9B,MAAM6B,SAAS,GAAGzB,gBAAgB,CAACkB,MAAM,CAACT,IAAI,CAAC;EAE/C,MAAMiB,OAAO,GAAG,MAAAA,CAAOL,OAAO,GAAG,CAAC,CAAC,KAAK;IACpCjB,YAAY,CAACkB,OAAO,EAAE;MAClB,CAACR,YAAY,CAACC,KAAK,GAAG,MAAMS,QAAQ,CAACrB,mBAAmB,CAAC;QAAEM,IAAI,EAAES,MAAM,CAACT,IAAI;QAAEgB,SAAS,EAAE;MAAK,CAAC,CAAC,CAAC;MACjG,CAACX,YAAY,CAACE,GAAG,GAAG,MAAMQ,QAAQ,CAACvB,cAAc,CAAC,CAAC;IACvD,CAAC,CAAC;IAEF,IAAI;MACA,MAAM0B,QAAQ,GAAG,MAAM,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACpDN,QAAQ,CACJN,MAAM,CAAC;UACH,GAAGG,OAAO;UACVU,WAAW,EAAGJ,QAAQ,IAAKE,OAAO,CAACF,QAAQ,EAAEf,IAAI,IAAI,CAAC,CAAC,CAAC;UACxDoB,OAAO,EAAEF;QACb,CAAC,CACL,CAAC;MACL,CAAC,CAAC;MAEFN,QAAQ,CAAC;QAAEf,IAAI,EAAEV,uBAAuB,CAACmB,MAAM,CAACT,IAAI,CAAC;QAAEY,OAAO,EAAEX,aAAa,CAACU,kBAAkB,EAAEO,QAAQ,EAAEN,OAAO;MAAE,CAAC,CAAC;IAC3H,CAAC,CAAC,OAAOY,KAAK,EAAE;MACZC,OAAO,CAACC,GAAG,CAAC;QAAEF;MAAM,CAAC,CAAC;MACtBT,QAAQ,CAAC;QAAEf,IAAI,EAAEX,uBAAuB,CAACoB,MAAM,CAACT,IAAI,CAAC;QAAEY,OAAO,EAAEY;MAAM,CAAC,CAAC;IAC5E,CAAC,SAAS;MACN7B,YAAY,CAACkB,OAAO,EAAE;QAClB,CAACR,YAAY,CAACC,KAAK,GAAG,MAAMS,QAAQ,CAACrB,mBAAmB,CAAC;UAAEM,IAAI,EAAES,MAAM,CAACT,IAAI;UAAEgB,SAAS,EAAE;QAAM,CAAC,CAAC,CAAC;QAClG,CAACX,YAAY,CAACE,GAAG,GAAG,MAAMQ,QAAQ,CAACtB,cAAc,CAAC,CAAC;MACvD,CAAC,CAAC;IACN;EACJ,CAAC;EAEDP,SAAS,CAAC,MAAM;IACZ,IAAIwB,SAAS,EAAE;MACXO,OAAO,CAACL,OAAO,CAAC;IACpB;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO;IAAEK,OAAO;IAAEJ,OAAO,EAAEG;EAAU,CAAC;AAC1C,CAAC;AAACF,EAAA,CA7CIN,cAAc;EAAA,QAMCrB,WAAW,EACVI,gBAAgB;AAAA;AAwCtCiB,cAAc,CAACH,YAAY,GAAGA,YAAY;AAE1C,eAAeG,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}